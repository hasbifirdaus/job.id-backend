generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Users {
  role                  UserRole               @default(JOB_SEEKER)
  name                  String                 @db.VarChar(100)
  email                 String                 @unique @db.VarChar(100)
  password              String                 @db.VarChar(255)
  dob                   DateTime?
  gender                Gender?
  education             String?                @db.VarChar(100)
  address               String?
  profile_image_url     String?                @db.VarChar(255)
  verified              Boolean                @default(false)
  deleted_at            DateTime?
  created_at            DateTime               @default(now())
  updated_at            DateTime               @updatedAt
  id                    String                 @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  applicationHistories  ApplicationHistories[] @relation("HistoryChangedBy")
  applications          Applications[]
  companyAdmins         CompanyAdmins[]
  interviews            Interviews[]           @relation("InterviewChangedBy")
  approvedSubscriptions Subscriptions[]        @relation("ApprovedBy")
  subscriptions         Subscriptions[]
  authProviders         UserAuthProviders[]
  skills                UserSkills[]

  @@index([deleted_at])
}

model UserAuthProviders {
  id            Int      @id @default(autoincrement())
  provider_name String   @db.VarChar(50)
  provider_id   String   @db.VarChar(255)
  created_at    DateTime @default(now())
  user_id       String   @db.Uuid
  user          Users    @relation(fields: [user_id], references: [id])
}

model Companies {
  id             Int                  @id @default(autoincrement())
  name           String               @db.VarChar(100)
  email          String               @unique @db.VarChar(100)
  phone          String               @db.VarChar(50)
  description    String?
  location       String?              @db.VarChar(150)
  logo_image_url String?              @db.VarChar(255)
  deleted_at     DateTime?
  created_at     DateTime             @default(now())
  updated_at     DateTime             @updatedAt
  admins         CompanyAdmins[]
  socials        CompanySocialLinks[]
  tags           CompanyTags[]
  jobs           Jobs[]

  @@index([deleted_at])
  @@index([name])
}

model CompanyAdmins {
  company_id Int
  is_primary Boolean   @default(false)
  role       String    @db.VarChar(50)
  user_id    String    @db.Uuid
  company    Companies @relation(fields: [company_id], references: [id])
  user       Users     @relation(fields: [user_id], references: [id])

  @@id([user_id, company_id])
  @@unique([company_id, is_primary])
}

model CompanySocialLinks {
  id         Int       @id @default(autoincrement())
  company_id Int
  platform   String    @db.VarChar(50)
  url        String    @db.VarChar(255)
  deleted_at DateTime?
  company    Companies @relation(fields: [company_id], references: [id])

  @@index([deleted_at])
}

model Categories {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(100)
  jobs Jobs[]
}

model Provinces {
  id         Int      @id @default(autoincrement())
  name       String   @unique @db.VarChar(100)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  cities     Cities[]
}

model Cities {
  id          Int       @id @default(autoincrement())
  province_id Int
  name        String    @unique @db.VarChar(100)
  created_at  DateTime  @default(now())
  updated_at  DateTime  @updatedAt
  province    Provinces @relation(fields: [province_id], references: [id])
  jobs        Jobs[]
}

model Jobs {
  id               Int                @id @default(autoincrement())
  company_id       Int
  category_id      Int
  city_id          Int
  title            String             @db.VarChar(150)
  description      String
  banner_image_url String?            @db.VarChar(255)
  min_salary       Decimal            @db.Decimal(12, 2)
  max_salary       Decimal            @db.Decimal(12, 2)
  deadline         DateTime
  is_published     Boolean
  deleted_at       DateTime?
  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  applications     Applications[]
  tags             JobTags[]
  category         Categories         @relation(fields: [category_id], references: [id])
  city             Cities             @relation(fields: [city_id], references: [id])
  company          Companies          @relation(fields: [company_id], references: [id])
  preSelectionTest PreSelectionTests?

  @@index([deleted_at])
  @@index([title])
}

model Tags {
  id          Int           @id @default(autoincrement())
  name        String        @unique @db.VarChar(50)
  companyTags CompanyTags[]
  jobTags     JobTags[]
  userSkills  UserSkills[]

  @@index([name])
}

model JobTags {
  job_id     Int
  tag_id     Int
  created_at DateTime @default(now())
  job        Jobs     @relation(fields: [job_id], references: [id])
  tag        Tags     @relation(fields: [tag_id], references: [id])

  @@id([job_id, tag_id])
}

model Applications {
  id                Int                    @id @default(autoincrement())
  job_id            Int
  test_id           Int?
  cv_url            String?                @db.VarChar(255)
  cover_letter      String?
  expected_salary   Decimal                @db.Decimal(12, 2)
  status            ApplicationStatus      @default(SUBMITTED)
  feedback          String?
  test_score        Decimal?               @db.Decimal(5, 2)
  test_completed_at DateTime?
  created_at        DateTime               @default(now())
  updated_at        DateTime               @updatedAt
  user_id           String                 @db.Uuid
  histories         ApplicationHistories[]
  job               Jobs                   @relation(fields: [job_id], references: [id])
  test              PreSelectionTests?     @relation(fields: [test_id], references: [id])
  user              Users                  @relation(fields: [user_id], references: [id])
  interviews        Interviews[]
  answers           PreSelectionAnswers[]

  @@unique([user_id, job_id])
}

model ApplicationHistories {
  id              Int               @id @default(autoincrement())
  application_id  Int
  previous_status ApplicationStatus
  new_status      ApplicationStatus
  notes           String?
  deleted_at      DateTime?
  changed_at      DateTime          @default(now())
  changed_by      String            @db.Uuid
  application     Applications      @relation(fields: [application_id], references: [id])
  user            Users             @relation("HistoryChangedBy", fields: [changed_by], references: [id])

  @@index([deleted_at])
}

model Interviews {
  id             Int             @id @default(autoincrement())
  application_id Int
  schedule_date  DateTime
  interview_type InterviewType
  location       String?         @db.VarChar(255)
  meeting_link   String?         @db.VarChar(255)
  status         InterviewStatus @default(SCHEDULED)
  notes          String?
  deleted_at     DateTime?
  created_at     DateTime        @default(now())
  updated_at     DateTime        @updatedAt
  changed_by     String?         @db.Uuid
  application    Applications    @relation(fields: [application_id], references: [id])
  user           Users?          @relation("InterviewChangedBy", fields: [changed_by], references: [id])

  @@index([deleted_at])
}

model SubscriptionPlans {
  id               Int             @id @default(autoincrement())
  plan_name        String          @unique @db.VarChar(50)
  price            Decimal         @db.Decimal(12, 2)
  duration_in_days Int
  features         String?
  subscriptions    Subscriptions[]
}

model Subscriptions {
  id          Int                @id @default(autoincrement())
  plan_id     Int
  status      SubscriptionStatus @default(PENDING)
  start_date  DateTime
  end_date    DateTime
  deleted_at  DateTime?
  created_at  DateTime           @default(now())
  updated_at  DateTime           @updatedAt
  user_id     String             @db.Uuid
  approved_by String?            @db.Uuid
  payments    Payments[]
  approver    Users?             @relation("ApprovedBy", fields: [approved_by], references: [id])
  plan        SubscriptionPlans  @relation(fields: [plan_id], references: [id])
  user        Users              @relation(fields: [user_id], references: [id])

  @@index([deleted_at])
}

model Payments {
  id              Int           @id @default(autoincrement())
  subscription_id Int
  amount          Decimal       @db.Decimal(12, 2)
  currency        String        @default("IDR") @db.VarChar(10)
  status          PaymentStatus
  payment_method  PaymentMethod
  proof_url       String?       @db.VarChar(255)
  transaction_id  String        @unique @db.VarChar(255)
  paid_at         DateTime?
  created_at      DateTime      @default(now())
  subscription    Subscriptions @relation(fields: [subscription_id], references: [id])
}

model PreSelectionTests {
  id           Int                     @id @default(autoincrement())
  job_id       Int                     @unique
  title        String                  @db.VarChar(150)
  deleted_at   DateTime?
  created_at   DateTime                @default(now())
  updated_at   DateTime                @updatedAt
  applications Applications[]
  questions    PreSelectionQuestions[]
  job          Jobs                    @relation(fields: [job_id], references: [id])
}

model PreSelectionQuestions {
  id             Int                   @id @default(autoincrement())
  test_id        Int
  question       String
  option_a       String                @db.VarChar(255)
  option_b       String                @db.VarChar(255)
  option_c       String                @db.VarChar(255)
  option_d       String                @db.VarChar(255)
  correct_answer QuestionOption
  deleted_at     DateTime?
  answers        PreSelectionAnswers[]
  test           PreSelectionTests     @relation(fields: [test_id], references: [id])

  @@index([deleted_at])
}

model PreSelectionAnswers {
  application_id Int
  question_id    Int
  user_answer    QuestionOption
  is_correct     Boolean
  created_at     DateTime              @default(now())
  application    Applications          @relation(fields: [application_id], references: [id])
  question       PreSelectionQuestions @relation(fields: [question_id], references: [id])

  @@id([application_id, question_id])
}

model UserSkills {
  tag_id     Int
  created_at DateTime @default(now())
  user_id    String   @db.Uuid
  tag        Tags     @relation(fields: [tag_id], references: [id])
  user       Users    @relation(fields: [user_id], references: [id])

  @@id([user_id, tag_id])
}

model CompanyTags {
  company_id Int
  tag_id     Int
  created_at DateTime  @default(now())
  company    Companies @relation(fields: [company_id], references: [id])
  tag        Tags      @relation(fields: [tag_id], references: [id])

  @@id([company_id, tag_id])
}

enum UserRole {
  JOB_SEEKER
  COMPANY_ADMIN
  DEVELOPER
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum ApplicationStatus {
  SUBMITTED
  REVIEWED
  ACCEPTED
  REJECTED
}

enum InterviewStatus {
  SCHEDULED
  COMPLETED
  CANCELED
}

enum InterviewType {
  ONLINE
  OFFLINE
  HYBRID
}

enum SubscriptionStatus {
  ACTIVE
  EXPIRED
  PENDING
}

enum QuestionOption {
  A
  B
  C
  D
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
}

enum PaymentMethod {
  BANK_TRANSFER
  EWALLET
  CREDIT_CARD
}
